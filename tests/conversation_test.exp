#!/usr/bin/expect -f
# WiseOwl CLI Conversation Test

set timeout 30
set prompt "You: "

# Start WiseOwl CLI
spawn ./target/release/wiseowlcli

# Wait for startup
expect {
    "WISEOWL CLI" { 
        puts "âœ… WiseOwl CLI started"
    }
    timeout { 
        puts "âŒ Startup timeout"
        exit 1
    }
}

expect $prompt

# Test 1: Simple question
puts "\nğŸ”µ TEST 1: Simple conversation"
send "What is 2+2?\r"

expect {
    "â³" {
        puts "âœ… Progress indicator shown"
    }
    timeout {
        puts "âŒ No progress indicator"
    }
}

expect {
    "AI:" {
        puts "âœ… AI responded"
    }
    timeout {
        puts "âŒ No AI response"
        exit 1
    }
}

expect $prompt

# Test 2: Dashboard command
puts "\nğŸ”µ TEST 2: Dashboard command"
send "/dashboard\r"

expect {
    "LCARS" {
        puts "âœ… Dashboard opened"
        sleep 2
        send "\x1b"
        puts "âœ… Sent Esc to close"
    }
    timeout {
        puts "âŒ Dashboard failed"
    }
}

expect $prompt

# Test 3: Direct file command
puts "\nğŸ”µ TEST 3: Direct file command"
send "/write-direct /tmp/wiseowl_test.txt Hello\r"

expect {
    "âœ… Wrote" {
        puts "âœ… File written"
    }
    timeout {
        puts "âŒ Write failed"
    }
}

expect $prompt

# Exit
puts "\nğŸ”µ Exiting"
send "exit\r"

expect eof

puts "\nâœ… ALL TESTS PASSED!"
exit 0
