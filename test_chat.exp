#!/usr/bin/expect -f

# Test OCLI chat functionality
set timeout 60

puts "ğŸ§ª Testing OCLI chat mode..."

# Test 1: Default chat mode (no subcommand)
spawn ocli

expect "ğŸ¤– OCLI - Using deepseek-coder:6.7b" {
    puts "âœ… Chat mode started successfully"
} timeout {
    puts "âŒ Chat mode failed to start"
    exit 1
}

expect "You: " {
    puts "âœ… Chat prompt appeared"
} timeout {
    puts "âŒ Chat prompt didn't appear"
    exit 1
}

# Send a simple test
send "Say hi\r"

expect "AI: " {
    puts "âœ… AI response started"
} timeout {
    puts "âŒ AI didn't respond"
    exit 1
}

# Wait for response content
expect {
    "Hi" {
        puts "âœ… Got AI response!"
        exp_continue
    }
    "Hello" {
        puts "âœ… Got AI response!"
        exp_continue
    }
    "You: " {
        puts "âœ… Back to chat prompt"
    }
    timeout {
        puts "âŒ Timeout waiting for response"
        exit 1
    }
}

# Test exit
send "exit\r"
expect "Goodbye! ğŸ‘‹"
expect eof

puts "ğŸ‰ Chat mode test passed!"
