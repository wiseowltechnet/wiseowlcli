#!/usr/bin/expect -f

# Test script for OCLI
set timeout 30

# Start OCLI
spawn ocli

# Wait for the prompt
expect "ğŸ¤– OCLI - Using deepseek-coder:6.7b"
expect "You: "

# Send a simple test question
send "Write hello world in Python\r"

# Wait for AI response to start
expect "AI: "

# Wait for response to complete (look for the next prompt)
expect "You: " {
    puts "\nâœ… Test 1 PASSED: Got response and returned to prompt"
} timeout {
    puts "\nâŒ Test 1 FAILED: Timeout waiting for response"
    exit 1
}

# Test exit command
send "exit\r"

# Wait for goodbye message
expect "Goodbye! ğŸ‘‹" {
    puts "âœ… Test 2 PASSED: Exit command works"
} timeout {
    puts "âŒ Test 2 FAILED: Exit command didn't work"
    exit 1
}

# Wait for process to actually exit
expect eof {
    puts "âœ… Test 3 PASSED: Process exited cleanly"
} timeout {
    puts "âŒ Test 3 FAILED: Process didn't exit"
    exit 1
}

puts "\nğŸ‰ All tests passed!"
